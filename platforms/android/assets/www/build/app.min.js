function config(e,t,n){t.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|file|blob|content|ms-appx|x-wmapp0):|data:image\/|img\//),t.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|ghttps?|ms-appx|x-wmapp0):/),n.initialize("nYsB6tmBMYKYMzM5iV9BUcBvHWX89ItPX5GfbN6Q","zrin8GEBDVGbkl1ioGEwnHuP70FdG6HhzTS8uGjz"),ionic.Platform.isIOS()&&e.scrolling.jsScrolling(!0)}function routes(e,t){t.otherwise("app/dashboard"),e.state("app",{url:"/app","abstract":!0,cache:!1,templateUrl:"templates/menu.html",controller:"MenuCtrl",resolve:{tournament:function(e){return e.getTournament()}}}).state("app.dashboard",{url:"/dashboard",cache:!1,views:{menuContent:{templateUrl:"templates/dashboard.html",controller:"DashboardCtrl"}}}).state("app.login",{url:"/login",cache:!1,views:{menuContent:{templateUrl:"templates/login.html",controller:"LoginCtrl"}}}).state("app.register",{url:"/register",cache:!1,views:{menuContent:{templateUrl:"templates/register.html",controller:"RegisterCtrl"}}})}function run(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.cordova&&window.parsePlugin.subscribe("SampleChannel",function(){console.log("Successfully subscribed to SampleChannel."),window.parsePlugin.getInstallationId(function(e){console.log("Retrieved install id: "+e)},function(e){console.log("Failure to retrieve install id.")})},function(e){console.log("Failed trying to subscribe to SampleChannel.")}),window.StatusBar&&StatusBar.styleDefault()})}function AdminMatchesCtrl(e,t){}function AdminPlayersCtrl(e,t){}function AdminSettingsCtrl(e,t,n){e.details=n}function DashboardCtrl(e,t,n,r,a,o,s,u,i,l,c){function d(){e.selected.status=!0;var t=n("filter")(e.heroList,{checked:!0},!0);t.length&&(t[0].checked=!1),o.show({templateUrl:"templates/popups/select.hero.html",title:"Select Hero Class",scope:e,buttons:[{text:"Cancel"},{text:"<b>Queue</b>",type:"button-positive",onTap:function(t){var r=n("filter")(e.heroList,{checked:!0},!0);return r.length?r[0]:void t.preventDefault()}}]}).then(function(t){t&&l.joinQueue(e.tournament,e.user.current(),t.text,e.player[0].battleTag).then(function(t){e.status="queue",e.queue.push(t),e.startSearch(),p()})})}function m(){return e.user.current()?e.player.length?e.queue.length?(e.status="queue",void p()):e.match.length?void(e.status="match"):void(e.status="open"):void(e.status="unregistered"):void(e.status="unauthorized")}function p(){l.checkStatus(e.tournament,e.user.current()).then(function(t){return t.length?("pending"===t[0].status&&(e.queue[0]=t[0],e.startSearch()),"found"===t[0].status?(e.status="match",void h(t[0])):("completed"===t[0].status&&console.log(t),void s.Cloud.run("MatchMaking").then(function(e){console.log(e),r(p,7e3)}))):void(e.searching=!1)})}function h(n){var n=n;o.alert({title:"Matchmaking",template:'<div class="text-center"><strong>A Worthy Opponent</strong><br> has been found!</div>'}).then(function(r){n.set("status","completed"),n.save().then(function(){e.status="match",t.go("app.match.view")})})}function g(){e.myOpponent.name=e.opponent.list[Math.floor(Math.random()*e.opponent.list.length)]}var f;e.user=s.User,e.status="open",e.tournament=u[0].tournament,c.getPlayer(e.tournament,e.user.current()).then(function(t){e.player=t,e.player.length?l.checkStatus(e.tournament,e.user.current()).then(function(t){e.queue=t,i.getMatch().then(function(t){e.match=t,m()})}):(e.queue=[],e.match=[],m())}),e.heroList=l.heroes,e.selected={status:!0},e.opponent=l.opponent,e.myOpponent={name:"PAX Attendee"},e.startQueue=function(){d()},e.cancelQueue=function(){l.cancelQueue(e.queue[0]).then(function(){e.status="open",e.queue=[],e.stop()})},e.stop=function(){a.cancel(f)},e.startSearch=function(){e.stop(),f=a(function(){g()},2e3)},e.$on("$destroy",function(){e.stop()}),e.selectHero=function(t){return e.image=angular.element(document.querySelector(".heroClass"))[0].clientWidth,t.checked?(t.checked=!t.checked,void(e.selected.status=!0)):!t.checked&&e.selected.status?(t.checked=!t.checked,void(e.selected.status=!1)):void 0}}function LadderJoinCtrl(e,t,n,r,a,o,s,u,i,l){function c(){var t=l.defer(),n=e.player.battleTag;if(n.length<8)return t.reject("Enter your full battle tag"),t.promise;var r=n.split("#");return 2!==r.length?(t.reject("Enter your full BATTLETAG™ including # and four digits"),t.promise):r[1].length<2||r[1].length>4?(t.reject("Your BATTLETAG™ must including up to four digits after #!"),t.promise):isNaN(r[1])?(t.reject("Your BATTLETAG™ must including four digits after #"),t.promise):(i.validatePlayer(e.tournament.tournament,n).then(function(e){e.length?t.reject("The BATTLETAG™ you entered is already registered."):t.resolve(n)}),t.promise)}function d(e){return r.alert({title:"Registration Error",template:e})}function m(e){return r.alert({title:"Congratulations "+e.battleTag+"!",template:"You have successfully signed up! Now go find a valiant opponent."})}e.tournament=s[0],e.user=t.User.current(),e.player={battleTag:""},e.registerPlayer=function(){c().then(function(t){u.joinTournament(e.tournament.tournament,e.player).then(function(t){e.tournament.increment("playerCount"),e.tournament.save().then(function(){m(t).then(function(e){o.nextViewOptions({disableBack:!0}),a.go("app.dashboard")})})})},function(e){d(e)})}}function LeaderBoardsCtrl(e,t,n,r,a,o){e.user=r.User,t.getPlayers(n[0].tournament).then(function(t){var n=1;angular.forEach(t,function(e){e.rank=n,n++}),e.players=t}),e.showDetails=function(t){e.heroes=t.heroes,o.alert({title:t.username+" Heroes",scope:e,template:'<div class="row"><div class="col-25 text-center" ng-repeat="hero in heroes"><img ng-src="img/icons/{{hero}}.png" class="responsive-img" style="padding:3px;">{{hero}}</div></div>'})}}function LoginCtrl(e,t,n,r){e.user={},n.User.logOut(),e.loginUser=function(){n.User.logIn(e.user.username,e.user.password,{success:function(e){r.nextViewOptions({disableBack:!0}),t.go("app.dashboard")},error:function(t,n){e.warning=n.message}})},e.$watch("user",function(t,n){e.warning=null},!0)}function MatchViewCtrl(e,t,n,r,a,o,s,u,i){function l(){e.opponent={hero:null,battleTag:null},e.match.player1.id===e.user.id&&(e.opponent.hero=e.match.hero2,e.opponent.username=e.match.username2,e.opponent.battleTag=e.match.battleTag2,e.opponent.user=e.match.player2),e.match.player2.id===e.user.id&&(e.opponent.hero=e.match.hero1,e.opponent.username=e.match.username1,e.opponent.battleTag=e.match.battleTag1,e.opponent.user=e.match.player1),c()}function c(){i.opponentHasConfirmed(e.opponent.user).then(function(o){return o.length?(e.noOpponent=!0,e.count<2?e.count++:o[0].destroy().then(function(){e.match.destroy().then(function(){r.alert({title:"Match Error",template:'<div class="text-center">Your Opponent never confirmed!</div>'}).then(function(e){a.nextViewOptions({disableBack:!0}),t.go("app.dashboard")})})}),void n(c,15e3)):void(e.noOpponent=!1)})}e.count=0,e.user=o.User.current(),u.getMatch().then(function(n){n.length?(e.match=n[0],l()):t.go("app.dashboard")}),e.record=function(n){u.getMatch().then(function(o){if(o.length){var s=o[0];if("active"===s.get("status")){switch(n){case"win":s.set("winner",e.user),s.set("loser",e.opponent.user);break;case"loss":s.set("winner",e.opponent.user),s.set("loser",e.user)}s.set("status","completed"),s.save().then(function(){r.alert({title:"Match Submitted",template:'<div class="text-center">Thank you for submitting results</div>'}).then(function(e){a.nextViewOptions({disableBack:!0}),t.go("app.dashboard")})})}}else r.alert({title:"Match Error",template:'<div class="text-center">Your Opponent has already updated results!</div>'}).then(function(e){a.nextViewOptions({disableBack:!0}),t.go("app.dashboard")})})}}function MenuCtrl(e,t,n,r,a){e.user=a.User,t.fromTemplateUrl("templates/popovers/profile.pop.html",{scope:e}).then(function(t){e.popover=t}),e.menu=function(t){r.nextViewOptions({disableBack:!0}),n.go("app."+t,{reload:!0}),e.popover.hide()},e.$on("$destroy",function(){e.popover.remove()})}function RegisterCtrl(e,t,n,r){function a(e){return r.alert({title:"Registration Error",template:e})}e.user={},e.RegisterUser=function(e){var r=new n.User;r.set(e),r.signUp(null,{success:function(e){t.go("app.dashboard")},error:function(e,t){a(t.message)}})},e.$watch("user",function(t,n){e.warning=null},!0)}function AdminRoutes(e){e.state("app.admin",{url:"/admin","abstract":!0,cache:!1,views:{menuContent:{templateUrl:"templates/admin/admin.html"}}}).state("app.admin.settings",{url:"/settings",cache:!1,templateUrl:"templates/admin/admin.settings.html",controller:"AdminSettingsCtrl",resolve:{tourney:function(e){return e.getTournament()},newTournament:function(e,t){return t.length?t[0]:e.createTournament()}}}).state("app.admin.matches",{url:"/matches",cache:!1,templateUrl:"templates/admin/admin.matches.html",controller:"AdminMatchesCtrl"})}function LadderRoutes(e){e.state("app.ladder",{url:"/ladder","abstract":!0,cache:!1,views:{menuContent:{templateUrl:"templates/ladder/ladder.html"}}}).state("app.ladder.leaderboard",{url:"/leaderboards",cache:!1,templateUrl:"templates/ladder/leaderboard.html",controller:"LeaderBoardsCtrl"}).state("app.ladder.join",{url:"/join",cache:!1,templateUrl:"templates/ladder/join.html",controller:"LadderJoinCtrl",resolve:{tourney:function(e){return e.getTournament()}}})}function MatchRoutes(e){e.state("app.match",{url:"/match","abstract":!0,cache:!1,views:{menuContent:{templateUrl:"templates/match/match.html"}}}).state("app.match.view",{url:"/view",cache:!1,templateUrl:"templates/match/match.view.html",controller:"MatchViewCtrl"})}function LadderServices(e,t){function n(n){var r=new e.Query(t.Model);return r.equalTo("tournament",n),r.descending("points","mmr"),r.find()}function r(n,r){var a=new e.Query(t.Model);return a.equalTo("tournament",n),a.equalTo("battleTag",r),a.find()}function a(n,r){var a=new e.Query(t.Model);return a.equalTo("tournament",n),a.equalTo("user",r),a.find()}return{getPlayers:n,getPlayer:a,validatePlayer:r}}function Ladder(e){var t=e.Object.extend("Ladder"),n=["tournament","user","battleTag","username","heroes","wins","losses","mmr","points"];return e.defineAttributes(t,n),{Model:t}}function MatchServices(e,t){function n(){var t=new e.Query("Match");t.equalTo("username1",r.username);var n=new e.Query("Match");n.equalTo("username2",r.username);var a=e.Query.or(t,n);return a.equalTo("status","active"),a.find()}var r=e.User.current();return{getMatch:n}}function Match(e){var t=e.Object.extend("Match"),n=["tournament","player1","player2","hero1","hero2","username1","username2","battleTag1","battleTag2","status","winner","loser","screenshot","report","reportedScreenshot"];return e.defineAttributes(t,n),{Model:t}}function QueueServices(e,t){function n(n){var r=new e.Query(t.Model);return r.equalTo("user",n),r.equalTo("status","found"),r.find()}function r(n,r){var a=new e.Query(t.Model);return a.equalTo("user",r),a.containedIn("status",["pending","found"]),a.equalTo("tournament",n),a.find()}function a(e,n,r,a){var o=new t.Model;return o.set("user",n),o.set("tournament",e),o.set("status","pending"),o.set("battleTag",a),o.set("hero",r),o.save()}function o(e){var n=new t.Model;return n.id=e.id,n.destroy()}var s={list:["Easy Pickings","Your Worst Nightmare","World class paste eater","A Murloc","Gourd critic","Nose and mouth breather","Hogger","A cardish Ian","Mopey Mage","Wombat Warlock","Rouged up Rogue","Waifish Warrior","Damp Druid","Shabby Shaman","Penniless Paladin","Huffy Hunter","Perky Priest","The Worst Player","Your Old Roommate","StarCraft Pro","Fiscally responsible mime","Your Guild Leader","Noneck George","Gum Pusher","Cheater McCheaterson","Really slow guy","Roach Boy","Orange Rhymer","Coffee Addict","Inward Talker","Blizzard Developer","Grand Master","Diamond League Player","Brand New Player","Dastardly Death Knight","Mediocre Monk","A Little Puppy"]},u=[{text:"mage",checked:!1},{text:"hunter",checked:!1},{text:"paladin",checked:!1},{text:"warrior",checked:!1},{text:"druid",checked:!1},{text:"warlock",checked:!1},{text:"shaman",checked:!1},{text:"priest",checked:!1},{text:"rogue",checked:!1}];return{opponent:s,heroes:u,checkStatus:r,joinQueue:a,cancelQueue:o,opponentHasConfirmed:n}}function Queue(e){var t=e.Object.extend("Queue"),n=["tournament","user","status","hero","battleTag"];return e.defineAttributes(t,n),{Model:t}}function TournamentServices(e,t,n,r,a){function o(t,n){var n=new a.Model(n);return n.set("tournament",t),n.set("user",e.User.current()),n.set("username",e.User.current().username),n.set("mmr",1e3),n.set("wins",0),n.set("losses",0),n.set("points",0),n.save()}function s(){var t=new e.Query(r.Model);return t.equalTo("type","ladder"),t.include("tournament"),t.find()}function u(){var e=t.defer(),a=new n.Model;return a.set("name","ONOG OPEN"),a.set("status","pending"),a.set("game","hearthstone"),a.save().then(function(t){var n=new r.Model;n.set("tournament",t),n.set("type","ladder"),n.set("playerCount",0),n.set("numOfGames",5),n.save().then(function(t){e.resolve(t)})}),e.promise}function i(t){var n=new e.Query(a.Model);return n.equalTo("tournament",t),n.include("player"),n.find()}return{getTournament:s,createTournament:u,getLadder:i,joinTournament:o}}function Tournament(e){var t=e.Object.extend("Tournament"),n=["name","game","status","disabled","disabledReason"];return e.defineAttributes(t,n),{Model:t}}function Details(e){var t=e.Object.extend("Details"),n=["tournament","type","numOfGames","playerCount"];return e.defineAttributes(t,n),{Model:t}}angular.module("ONOG",["ionic","ngParse","ngCordova","ngAnimate","ONOG.Controllers","ONOG.Services"]),angular.module("ONOG").config(["$ionicConfigProvider","$compileProvider","ParseProvider",config]),angular.module("ONOG.Controllers",[]),angular.module("ONOG").config(["$stateProvider","$urlRouterProvider",routes]),angular.module("ONOG").run(["$ionicPlatform",run]),angular.module("ONOG.Services",[]),angular.module("ONOG.Controllers").controller("AdminMatchesCtrl",AdminMatchesCtrl),AdminMatchesCtrl.$inject=["$scope","Parse"],angular.module("ONOG.Controllers").controller("AdminPlayersCtrl",AdminPlayersCtrl),AdminPlayersCtrl.$inject=["$scope","Parse"],angular.module("ONOG.Controllers").controller("AdminSettingsCtrl",AdminSettingsCtrl),AdminSettingsCtrl.$inject=["$scope","TournamentServices","newTournament"],angular.module("ONOG.Controllers").controller("DashboardCtrl",["$scope","$state","$filter","$timeout","$interval","$ionicPopup","Parse","tournament","MatchServices","QueueServices","LadderServices",DashboardCtrl]),angular.module("ONOG.Controllers").controller("LadderJoinCtrl",LadderJoinCtrl),LadderJoinCtrl.$inject=["$scope","Parse","$filter","$ionicPopup","$state","$ionicHistory","tourney","TournamentServices","LadderServices","$q"],angular.module("ONOG.Controllers").controller("LeaderBoardsCtrl",LeaderBoardsCtrl),LeaderBoardsCtrl.$inject=["$scope","LadderServices","tournament","Parse","$filter","$ionicPopup"],angular.module("ONOG.Controllers").controller("LoginCtrl",LoginCtrl),LoginCtrl.$inject=["$scope","$state","Parse","$ionicHistory"],angular.module("ONOG.Controllers").controller("MatchViewCtrl",MatchViewCtrl),MatchViewCtrl.$inject=["$scope","$state","$timeout","$ionicPopup","$ionicHistory","Parse","LadderServices","MatchServices","QueueServices"],angular.module("ONOG.Controllers").controller("MenuCtrl",MenuCtrl),MenuCtrl.$inject=["$scope","$ionicPopover","$state","$ionicHistory","Parse"],angular.module("ONOG.Controllers").controller("RegisterCtrl",RegisterCtrl),RegisterCtrl.$inject=["$scope","$state","Parse","$ionicPopup"],angular.module("ONOG").config(["$stateProvider",AdminRoutes]),angular.module("ONOG").config(["$stateProvider",LadderRoutes]),angular.module("ONOG").config(["$stateProvider",MatchRoutes]),angular.module("ONOG.Services").service("LadderServices",["Parse","Ladder",LadderServices]).factory("Ladder",["Parse",Ladder]),angular.module("ONOG.Services").service("MatchServices",["Parse","Match",MatchServices]).factory("Match",["Parse",Match]),angular.module("ONOG.Services").service("QueueServices",["Parse","Queue",QueueServices]).factory("Queue",["Parse",Queue]),angular.module("ONOG.Services").service("TournamentServices",["Parse","$q","Tournament","Details","Ladder",TournamentServices]).factory("Tournament",["Parse",Tournament]).factory("Details",["Parse",Details]);